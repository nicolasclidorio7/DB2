{# templates/index.html #}

{% extends 'layout.html' %}

{% block content %}
    {# Bloco de mensagens flash (permanece o mesmo) #}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash flash-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <h1>Jogo da Forca</h1>
    <div class="placar">
        ğŸ† VitÃ³rias: {{ placar.vitorias }} | ğŸ’€ Derrotas: {{ placar.derrotas }}
    </div>

    {% if jogo %}
        <pre>{{ jogo.obter_visualizacao() }}</pre>

        {# LÃ³gica para mostrar o formulÃ¡rio ou a tela de fim de jogo #}
        {% if jogo.fim_de_jogo %}
            {% if jogo.vitoria %}
                <h2>ğŸ‰ VocÃª Venceu! ğŸ‰</h2>
            {% else %}
                <h2>â˜ ï¸ VocÃª Perdeu! A palavra era: {{ jogo.palavra_secreta }} â˜ ï¸</h2>
            {% endif %}
            <div class="centro">
                <a class="botao" href="{{ url_for('novo_jogo') }}">Jogar Novamente</a>
            </div>
        {% else %}
            {# O formulÃ¡rio sÃ³ aparece se o jogo nÃ£o acabou #}
            <div class="alphabet-container">
                <form method="POST" action="{{ url_for('index') }}" class="alphabet-form">
                    {# Juntamos as letras corretas e erradas para saber tudo que jÃ¡ foi tentado #}
                    {% set letras_tentadas = jogo.letras_corretas.union(jogo.letras_erradas) %}

                    {# Loop para criar um botÃ£o para cada letra do alfabeto #}
                    {% for letra in alfabeto %}
                        <button type="submit" name="letra" value="{{ letra }}"
                                class="letra-btn"
                                {# Desabilita o botÃ£o se a letra jÃ¡ foi tentada #}
                                {% if letra in letras_tentadas %}disabled{% endif %}>
                            {{ letra }}
                        </button>
                    {% endfor %}
                </form>
            </div>
            {% if erro %}
                <p class="erro">{{ erro }}</p>
            {% endif %}
        {% endif %}

    {% else %}
        <h2>Bem-vindo!</h2>
        <p>NÃ£o hÃ¡ nenhum jogo em andamento.</p>
        <div class="centro">
            <a class="botao" href="{{ url_for('novo_jogo') }}">Clique aqui para comeÃ§ar um novo jogo!</a>
        </div>
    {% endif %}
{% endblock %}